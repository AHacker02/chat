(this["webpackJsonpimessage-clone"]=this["webpackJsonpimessage-clone"]||[]).push([[0],{234:function(e,t,a){},235:function(e,t,a){},236:function(e,t,a){},237:function(e,t,a){},260:function(e,t,a){},261:function(e,t,a){},262:function(e,t,a){},269:function(e,t,a){},367:function(e,t,a){},369:function(e,t,a){},370:function(e,t,a){"use strict";a.r(t);var n=a(5),c=a(0),r=a(21),s=a.n(r),o=(a(234),a(235),a(60)),i=a(419),u=a(408),l=a(189),d=a.n(l),j=(a(236),a(237),a(15)),p=a(62),m=a(42),b=a(35),f=a.n(b),h=a(64),O=a(33),g=a(92),x=a.n(g),v=a(119),y=a.n(v),N="https://imessage-clone-signalr.herokuapp.com/",_=function(){var e,t=y.a.create({baseURL:N});(t.interceptors.response.use((function(e){return S(e)}),(function(e){return C(e)})),t.defaults.headers.common["Content-Type"]="application/json",t.defaults.headers.post["Content-Type"]="application/json",!t.defaults.headers.common.Authorization&&sessionStorage.getItem("user"))&&(t.defaults.headers.common.Authorization="Bearer ".concat(null===(e=JSON.parse(sessionStorage.getItem("user")))||void 0===e?void 0:e.token));return t.CancelToken=y.a.CancelToken,t}(),S=function(e){return e.data.isSuccess?e:Promise.reject({response:e,message:e.data.message})},C=function(e){return e.response.headers["application-error"]?e.message=e.response.headers["application-error"]:e.response.data.message&&(e.message=e.response.data.message),Promise.reject(e)};y.a.CancelToken.source();var w,k,I,A=_,R=Object(O.b)("chat/search",function(){var e=Object(h.a)(f.a.mark((function e(t,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"undefined"!==typeof k&&k.cancel("Operation canceled due to new request."),k=A.CancelToken.source(),e.next=4,A.get("/api/user/search",{params:{userSearch:t},cancelToken:k.token});case 4:return n=e.sent,e.abrupt("return",n.data.data);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),U=Object(O.b)("chat/selectChat",function(){var e=Object(h.a)(f.a.mark((function e(t,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.get("/api/chat/messages",{params:{userId:t.id}});case 2:return n=e.sent,e.abrupt("return",Object(m.a)(Object(m.a)({},t),{},{messages:n.data.data}));case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),T=Object(O.b)("chat/createGroup",function(){var e=Object(h.a)(f.a.mark((function e(t,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.post("/api/chat/create-group",JSON.stringify(t));case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),E={chats:{},selectedChat:null,searchResult:[]},M=Object(O.c)({name:"chat",initialState:E,reducers:{setChatList:function(e,t){x.a.forIn(x.a.mapKeys(t.payload,"id"),(function(t,a){e.chats[a]=t}))},setStatus:function(e,t){e.chats[t.payload.id].status=t.payload.status,e.chats[t.payload.id].clientId=t.payload.clientId},addMessage:function(e,t){var a,n;e.chats[t.payload.fromUserId]?n=t.payload.fromUserId:e.chats[t.payload.toUserId]&&(n=t.payload.toUserId),e.chats[n].lastMessage=t.payload.messageText,e.chats[n].lastMessageTime=t.payload.sentAt,(null===(a=e.selectedChat)||void 0===a?void 0:a.id)===n&&e.selectedChat.messages.push(t.payload)},resetChat:function(e,t){return E}},extraReducers:(w={},Object(p.a)(w,R.fulfilled,(function(e,t){e.searchResult=t.payload})),Object(p.a)(w,U.fulfilled,(function(e,t){e.selectedChat=t.payload,e.chats[t.payload.id]=t.payload,e.searchResult=null})),w)}),L=M.actions,P=L.setChatList,J=L.addMessage,z=L.setStatus,B=L.resetChat,D=function(e){return e.chat.selectedChat},F=function(e){return e.chat.chats},G=function(e){return e.chat.searchResult},V=M.reducer,W=a(112),K=a.n(W),q=function(e){var t,a=e.contact,c=Object(j.c)(),r=Object(j.d)(D);return Object(n.jsxs)("div",{onClick:function(){c(U(a))},className:"sidebarChat ".concat((null===r||void 0===r?void 0:r.id)===a.id?"sidebarChat__selected":null),children:[Object(n.jsx)(i.a,{src:null!==(t=a.photo)&&void 0!==t?t:"https://ui-avatars.com/api/?name=".concat(a.firstName,"+").concat(a.lastName,"&background=random")}),Object(n.jsxs)("div",{className:"sidebarChat__info",children:[Object(n.jsx)("h3",{children:"".concat(a.firstName," ").concat(a.lastName)}),Object(n.jsx)("p",{children:a.lastMessage}),Object(n.jsx)("small",{children:a.status?"Online"===a.status?"Online":K()(a.status).calendar():null})]})]})},H=Object(O.c)({name:"app",initialState:{form:{},loading:{group:!1}},reducers:{setFormError:function(e,t){e.form[t.payload.name]=t.payload.error},setLoading:function(e,t){e.loading[t.payload.name]=t.payload.loading}}}),Q=H.actions,X=Q.setFormError,Y=Q.setLoading,Z=function(e,t){return e.app.form[t]},$=function(e,t){return e.app.loading[t]},ee=H.reducer,te=sessionStorage.getItem("user")?JSON.parse(sessionStorage.getItem("user")):null,ae=Object(O.b)("user/login",function(){var e=Object(h.a)(f.a.mark((function e(t,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.dispatch(Y({name:"login",loading:!0})),e.next=4,A.get("/api/Auth/login",{params:t});case 4:return n=e.sent,a.dispatch(Y({name:"login",loading:!1})),e.abrupt("return",n.data.data);case 9:throw e.prev=9,e.t0=e.catch(0),a.dispatch(X({name:"login",error:e.t0.message})),a.dispatch(Y({name:"login",loading:!1})),new Error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,a){return e.apply(this,arguments)}}()),ne=Object(O.b)("user/register",function(){var e=Object(h.a)(f.a.mark((function e(t,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.dispatch(Y({name:"register",loading:!0})),e.next=4,A.post("/api/Auth/register",JSON.stringify(t));case 4:return n=e.sent,a.dispatch(ae({email:t.email,password:t.password})),a.dispatch(Y({name:"register",loading:!1})),e.abrupt("return",n.data.data);case 10:throw e.prev=10,e.t0=e.catch(0),a.dispatch(X({name:"register",error:e.t0.message})),a.dispatch(Y({name:"register",loading:!1})),new Error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,a){return e.apply(this,arguments)}}()),ce=Object(O.b)("user/logout",function(){var e=Object(h.a)(f.a.mark((function e(t,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.dispatch(B());case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),re=Object(O.c)({name:"user",initialState:{user:te},extraReducers:(I={},Object(p.a)(I,ae.fulfilled,(function(e,t){e.user=t.payload,sessionStorage.setItem("user",JSON.stringify(t.payload))})),Object(p.a)(I,ce.fulfilled,(function(e){e.user=null,sessionStorage.removeItem("user")})),I)}),se=function(e){var t;return null===(t=e.user.user)||void 0===t?void 0:t.user},oe=function(e){var t;return null===(t=e.user.user)||void 0===t?void 0:t.token},ie=re.reducer,ue=a(415),le=a(411),de=a(188),je=a.n(de),pe=a(416),me=function(e){var t=e.variant,a=void 0===t?"standard":t,r=e.selectResult,s=Object(j.c)(),i=Object(j.d)((function(e){return $(e,"search")})),u=Object(j.d)(G),l=Object(c.useState)(""),d=Object(o.a)(l,2),p=d[0],b=d[1],f=function(e){e.target.value&&b(e.target.value)};return Object(c.useEffect)((function(){""!==p&&s(R(p))}),[p]),Object(n.jsx)(pe.a,{inputValue:p,freeSolo:!0,disableClearable:!0,onChange:function(e,t){r(t),b("")},loading:i,filterOptions:function(e,t){return e},getOptionLabel:function(e){return"".concat(e.firstName," ").concat(e.lastName)},options:u,renderInput:function(e){return Object(n.jsx)(ue.a,Object(m.a)(Object(m.a)({onChange:f},e),{},{placeholder:"Search user",margin:"dense",fullWidth:!0,variant:a,InputProps:Object(m.a)(Object(m.a)({},e.InputProps),{},{type:"search",startAdornment:Object(n.jsx)(le.a,{position:"start",children:Object(n.jsx)(je.a,{})})})}))}})},be=function(e){var t,a=e.signOut,c=Object(j.d)(se),r=Object.values(Object(j.d)(F)),s=Object(j.c)();return Object(n.jsxs)("div",{className:"sidebar",children:[Object(n.jsxs)("div",{className:"sidebar__header",children:[Object(n.jsx)(i.a,{onClick:a,src:null!==(t=c.photo)&&void 0!==t?t:"https://ui-avatars.com/api/?name=".concat(c.firstName,"+").concat(c.lastName,"&background=random"),className:"sidebar__avatar"}),Object(n.jsx)("div",{className:"sidebar__input",children:Object(n.jsx)(me,{variant:"outlined",selectResult:function(e){s(U(e))}})}),Object(n.jsx)(u.a,{onClick:function(){return s(Y({name:"group",loading:!0}))},children:Object(n.jsx)(d.a,{})})]}),Object(n.jsx)("div",{className:"sidebar__chat",children:r.map((function(e){return Object(n.jsx)(q,{contact:e},e.id)}))})]})},fe=(a(260),a(190)),he=(a(261),Object(c.forwardRef)((function(e,t){var a=e.messageText,c=e.sentAt,r=e.fromUserId,s=Object(j.d)(se);return Object(n.jsxs)("div",{ref:t,className:"message ".concat(s.id===r&&"message__sender"),children:[Object(n.jsx)("p",{children:a}),Object(n.jsx)("small",{children:K()(c).fromNow()})]})}))),Oe=function(e){var t,a,r=e.sendMessage,s=Object(c.useState)(""),i=Object(o.a)(s,2),u=i[0],l=i[1],d=Object(j.d)(D);if(d)try{a=d.messages,a=x.a.orderBy(a,["sentAt"],["asc"])}catch(f){console.log(f)}var p=Object(c.useRef)(),b=function(){p.current.scrollIntoView({behavior:"smooth",block:"start"})};return Object(c.useEffect)((function(){b()}),[d]),Object(c.useEffect)((function(){b()}),[]),Object(n.jsxs)("div",{className:"chat",children:[Object(n.jsx)("div",{className:"chat__header",children:Object(n.jsxs)("h4",{children:["To:"," ",Object(n.jsx)("span",{className:"chat__name",children:d?"".concat(null===d||void 0===d?void 0:d.firstName," ").concat(null===d||void 0===d?void 0:d.lastName):null})]})}),Object(n.jsxs)("div",{className:"chat__messages",children:[Object(n.jsx)(fe.a,{children:null===(t=a)||void 0===t?void 0:t.map((function(e){return Object(n.jsx)(he,Object(m.a)({},e),e.id)}))}),Object(n.jsx)("div",{ref:p,className:"list-bottom"})]}),Object(n.jsx)("div",{className:"chat__input",children:Object(n.jsxs)("form",{onSubmit:function(e){e.preventDefault(),r(u),l("")},children:[Object(n.jsx)("input",{value:u,disabled:!d,onChange:function(e){return l(e.target.value)},placeholder:"Type a message",type:"text"}),Object(n.jsx)("button",{type:"submit",children:"Send Message"})]})})]})},ge=(a(262),a(193)),xe=a(121),ve=(xe.a.initializeApp({apiKey:"AIzaSyDd7RkOx-DN8Op7rU2NRpnaR3tghTr1Ec8",authDomain:"imessage-clone-54a5a.firebaseapp.com",projectId:"imessage-clone-54a5a",storageBucket:"imessage-clone-54a5a.appspot.com",messagingSenderId:"662929065374",appId:"1:662929065374:web:edec7a6203bc96d36c428f"}),xe.a.auth()),ye=new xe.a.auth.GoogleAuthProvider;ye.setCustomParameters({prompt:"select_account"});var Ne=a(118),_e=a(418),Se=a(412),Ce=a(413),we=a(409),ke=a(410),Ie=a(414),Ae=a(85),Re=a(180),Ue=a(181),Te=function(e){var t=e.input,a=e.meta,c=e.type,r=a.touched&&a.error;return Object(n.jsx)(ue.a,Object(m.a)({error:r,label:t.name.charAt(0).toLocaleUpperCase()+t.name.slice(1),type:c,margin:"normal",helperText:r?a.error:null},t))},Ee=(a(269),"group"),Me=Object(Ue.a)({form:"group"})((function(e){var t=e.group,a=void 0===t?null:t,r=e.handleSubmit,s=Object(j.d)((function(e){return $(e,Ee)})),u=Object(j.d)((function(e){return Z(e,Ee)})),l=Object(j.c)(),d=Object(j.d)(se),p=Object(c.useState)([d]),m=Object(o.a)(p,2),b=m[0],f=m[1],h=Object(c.useRef)();Object(c.useEffect)((function(){h.current&&h.current.scrollIntoView({behavior:"smooth",block:"start"})}),[b]);return Object(n.jsxs)(_e.a,{"aria-labelledby":"group-form-title",open:s,onClose:function(){l(Y({name:"group",loading:!1})),l(Object(Ae.a)(Ee)),f([d])},className:"group",children:[Object(n.jsx)(Se.a,{id:"group-form-title",className:"group__title",children:Object(n.jsx)("h3",{children:a?"Add User to group":"Create new group"})}),Object(n.jsx)(Ce.a,{children:Object(n.jsxs)(we.a,{onSubmit:r((function(e){var t=b.map((function(e){return e.id}));l(T({name:e.name,users:t})),l(Y({name:"group",loading:!1}))})),component:"form",margin:"none",className:"login__form",children:[u?Object(n.jsx)(ke.a,{error:!0,filled:!0,children:u}):null,Object(n.jsx)(Re.a,{name:"name",type:"text",component:Te}),Object(n.jsx)(me,{selectResult:function(e){f((function(t){return[].concat(Object(Ne.a)(t),[e])}))},multiple:!0}),Object(n.jsx)(Ie.a,{type:"submit",children:"Create Group"}),Object(n.jsxs)("ul",{className:"group__list",children:[b.map((function(e){var t;return Object(n.jsxs)("div",{className:"group__user",children:[Object(n.jsx)(i.a,{src:null!==(t=e.photo)&&void 0!==t?t:"https://ui-avatars.com/api/?name=".concat(e.firstName,"+").concat(e.lastName,"&background=random")}),Object(n.jsx)("h3",{children:"".concat(e.firstName," ").concat(e.lastName)})]})})),Object(n.jsx)("div",{ref:h,className:"list-bottom"})]})]})})]})})),Le=function(){var e=Object(j.d)(oe),t=Object(c.useState)(null),a=Object(o.a)(t,2),r=a[0],s=a[1],i=Object(j.d)(D),u=Object(j.c)();Object(c.useEffect)((function(){var t=(new ge.a).withUrl(N+"chat",{accessTokenFactory:function(){return e}}).withAutomaticReconnect().build();s(t)}),[e]),Object(c.useEffect)((function(){r&&(r.start().then((function(){console.log("Connected")})).catch((function(e){console.log("Connection failed:",e)})),r.on("Chats",(function(e){console.log("Chats",e),u(P(e))})),r.on("Message",(function(e){console.log("Message",e),u(J(e))})),r.on("UserStatus",(function(e){console.log("UserStatus",e),u(z(e))})))}),[r]);return Object(n.jsxs)("div",{className:"imessage",children:[Object(n.jsx)(be,{signOut:function(){ve.signOut(),u(ce()),r.stop()}}),Object(n.jsx)(Oe,{sendMessage:function(e){if(r.connectionStarted)try{r.invoke("SendMessage",i.id,i.clientId,e)}catch(t){console.log(t)}else alert("No connection to server yet.")}}),Object(n.jsx)(Me,{})]})},Pe=a(34),Je=Object(Pe.a)(),ze=a(27),Be=(a(367),a(89)),De=[{name:"email",type:"email"},{name:"password",type:"password"}],Fe="login",Ge=Object(Ue.a)({form:Fe,validate:function(e){var t={};return De.forEach((function(a){e[a.name]||(t[a.name]="".concat(a.name.charAt(0).toLocaleUpperCase()+a.name.slice(1)," cannot be empty"))})),t}})((function(e){var t=Object(j.c)(),a=Object(j.d)((function(e){return Z(e,Fe)})),c=Object(j.d)((function(e){return $(e,Fe)})),r=function(e){t(ae(e))};return Object(n.jsx)("div",{className:"login",children:Object(n.jsxs)("div",{className:"login__container",children:[Object(n.jsxs)("div",{className:"login__logo",children:[Object(n.jsx)("img",{src:"https://i.redd.it/jdto14wkj9f51.png",alt:""}),Object(n.jsx)("h1",{children:"iMessage"})]}),Object(n.jsxs)(we.a,{component:"form",margin:"normal",className:"login__form",onSubmit:e.handleSubmit(r),children:[a?Object(n.jsx)(ke.a,{error:!0,filled:!0,children:a}):null,De.map((function(e){return Object(n.jsx)(Re.a,{name:e.name,type:e.type,component:Te},e.name)})),Object(n.jsx)(Ie.a,{disabled:c,type:"submit",children:"Sign In"})]}),Object(n.jsxs)("div",{className:"login__social",children:[Object(n.jsx)("small",{children:"Or Sign In Using"}),Object(n.jsx)("img",{onClick:function(){ve.signInWithPopup(ye).then((function(e){r({email:e.user.email})})).catch((function(e){return t(X({name:Fe,error:e.message}))}))},src:"https://img-authors.flaticon.com/google.jpg",alt:""})]}),Object(n.jsxs)("p",{children:["Don't have an account?"," ",Object(n.jsx)(Be.a,{to:"/register",children:Object(n.jsx)("strong",{children:"Sign Up"})})]})]})})})),Ve=(a(369),[{name:"firstname",type:"text"},{name:"lastname",type:"text"},{name:"email",type:"email"},{name:"password",type:"password"}]),We="register",Ke=Object(Ue.a)({form:We})((function(e){var t=Object(j.d)((function(e){return Z(e,We)})),a=Object(j.d)((function(e){return $(e,We)})),c=Object(j.c)(),r=function(e){c(ne(e))};return Object(n.jsx)("div",{className:"register",children:Object(n.jsxs)("div",{className:"register__container",children:[Object(n.jsxs)(we.a,{component:"form",margin:"normal",className:"register__form",onSubmit:e.handleSubmit(r),children:[t?Object(n.jsx)(ke.a,{error:!0,filled:!0,children:t}):null,Ve.map((function(e){return Object(n.jsx)(Re.a,{name:e.name,type:e.type,component:Te})})),Object(n.jsx)(Ie.a,{disabled:a,type:"submit",children:"Create Account"})]}),Object(n.jsxs)("div",{className:"register__social",children:[Object(n.jsx)("small",{children:"Or Sign Up Using"}),Object(n.jsx)("img",{onClick:function(){ve.signInWithPopup(ye).then((function(e){var t=e.user;r({firstName:t.displayName.substr(0,t.displayName.indexOf(" ")),lastName:t.displayName.substr(t.displayName.indexOf(" ")+1),email:t.email,password:t.uid})})).catch((function(e){return c(X({name:We,error:e.message}))}))},src:"https://img-authors.flaticon.com/google.jpg",alt:""})]}),Object(n.jsxs)("p",{children:["Already have an account?"," ",Object(n.jsx)(Be.a,{to:"/login",children:Object(n.jsx)("strong",{children:"Login"})})]})]})})}));var qe=function(){var e=Object(j.d)(se);return Object(c.useEffect)((function(){e?Je.push("/"):Je.push("/login")}),[e]),Object(n.jsx)(ze.b,{history:Je,children:Object(n.jsx)("div",{className:"app",children:Object(n.jsxs)(ze.c,{children:[Object(n.jsx)(ze.a,{path:"/login",children:Object(n.jsx)(Ge,{})}),Object(n.jsx)(ze.a,{path:"/register",children:Object(n.jsx)(Ke,{})}),Object(n.jsx)(ze.a,{path:"/",children:e&&Object(n.jsx)(Le,{})})]})})})},He=a(23),Qe=a(182),Xe=Object(He.c)({user:ie,chat:V,form:Qe.a,app:ee}),Ye=Object(O.a)({reducer:Xe,middleware:[function(e){return function(e){return function(t){var a;return"user/login/fulfilled"===t.type&&(a=t.payload.token,_.defaults.headers.common.Authorization="Bearer ".concat(a)),e(t)}}}].concat(Object(Ne.a)(Object(O.d)()))});s.a.render(Object(n.jsx)(j.a,{store:Ye,children:Object(n.jsx)(qe,{})}),document.getElementById("root"))}},[[370,1,2]]]);
//# sourceMappingURL=main.2242435e.chunk.js.map